{"version":3,"sources":["pages/user/user.js"],"names":["app","getApp","useUrl","require","Page","data","title","userInfo","avatarUrl","hasmessage","videoSrc","videoCover","videoPlay","videoControls","autoplay","show","playStatus","objectFit","userPhotos","open_types","opertaion","ico","url","getMyInfo","that","getMO","getUserinfo","session_key","wx","getStorageSync","success","res","code","hasvideo","video_url","length","setData","photos","video_image","wxrequest","upVideo","videoObj","sourceType","maxDuration","camera","console","log","duration","showToast","showLoading","mask","i","tempFilePath","updateVideoUrl","filePath","formData","file","hideLoading","jsonObj","JSON","parse","res_file","fail","wxUpload","chooseVideo","edit","showActionSheet","itemList","itemColor","tapIndex","editVideo","updateVideoImage","obj","count","tempFilePaths","upImg","uploadPhotos","coverObj","message","err","chooseImage","videodel","getMyInfoid","getobj","getUserInfoBySelf","navigateTo","user_id","getUserInfo","logins","openSetting","authSetting","setStorageSync","wxlogin","playVideo","s","getSystemInfoSync","ss","brand","parseInt","system","split","showModal","content","showCancel","confirm","playFinish","getMessage","userHasNewMessage","isHas","onLoad","login","onReady","onShow","onHide","onUnload"],"mappings":"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","file":"user.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\nconst useUrl = require('../../utils/service')\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'user',\n    userInfo: {\n      avatarUrl: '../../images/login-img.png'\n    },\n    // 视屏\n    hasmessage: false, // 有消息状态\n    videoSrc: '',\n    videoCover: '',\n    videoPlay: '../../images/play.png',\n    videoControls: true,\n    autoplay: true,\n    show: true,\n    playStatus: false,\n    objectFit: 'fill',\n    // 相册\n    userPhotos: [],\n    open_types: 'navigate',\n    // 用户操作\n    opertaion: [\n      {\n        title: '消息箱',\n        ico: 'icon-xiaoxi',\n        url: '../message/message'\n      },\n      {\n        title: 'TA的档案',\n        ico: 'icon-dangan',\n        url: '../taRecord/taRecord'\n      },\n      {\n        title: '券包余额',\n        ico: 'icon-yue',\n        url: '../account/account'\n      },\n      {\n        title: '问卷调查',\n        ico: 'icon-wenjuan',\n        url: '../mySurvey/mySurvey'\n      },\n      {\n        title: '帮助指南',\n        ico: 'icon-FAQ',\n        url: '../faq/faq'\n      },\n      {\n        title: '反馈与客服',\n        ico: 'icon-fankui',\n        url: '../kefu/kefu'\n      }\n    ]\n  },\n  // 获取个人信息\n  getMyInfo () {\n    let that = this\n    let getMO = {\n      url: useUrl.getUserinfo,\n      data: {\n        session_key: wx.getStorageSync('session_key')\n      },\n      success (res) {\n        if (res.data.code === 200) {\n          let hasvideo = false\n          if (res.data.data.video_url.length > 0) {\n            hasvideo = true\n          }\n          // let { userInfo } = that.data\n          // userInfo['avatarUrl'] = res.data.data.avatar\n          // userInfo['nickName'] = res.data.data.user_nicename\n          // userInfo['gender'] = res.data.data.sex\n          that.setData({\n            hasvideo: hasvideo,\n            // userInfo: that.data.userInfo,\n            userPhotos: res.data.data.photos || [],\n            videoSrc: res.data.data.video_url,\n            videoCover: res.data.data.video_image || '../../images/login-bg.png'\n          })\n        } else {\n          // wx.showToast({\n          //   title: '未授权登陆,请点击【立即登录】'\n          // })\n        }\n      }\n    }\n    app.wxrequest(getMO)\n  },\n  // 上传视频\n  upVideo () {\n    let that = this\n    let videoObj = {\n      sourceType: ['album', 'camera'],\n      maxDuration: 60,\n      camera: 'front',\n      success (res) {\n        console.log(res)\n        if (res.duration > 60) {\n          return wx.showToast({\n            title: '请选择视频时间小于1分钟的'\n          })\n        }\n        wx.showLoading({\n          title: '视频上传中',\n          mask: true\n        })\n        let i = res.tempFilePath\n        let upVideo = {\n          url: useUrl.updateVideoUrl,\n          filePath: i,\n          formData: {\n            session_key: wx.getStorageSync('session_key'),\n            file: i\n          },\n          success (res) {\n            wx.hideLoading()\n            // console.log(res)\n            let jsonObj = JSON.parse(res.data).data.res_file\n            that.setData({\n              videoSrc: jsonObj,\n              hasvideo: true\n            })\n          },\n          fail (res) {\n            console.log('上传错误', res)\n            wx.showToast({\n              title: '视频上传失败，请重新尝试',\n              mask: true,\n              duration: 1000\n            })\n          }\n        }\n        app.wxUpload(upVideo)\n      }\n    }\n    wx.chooseVideo(videoObj)\n  },\n  edit () {\n    let that = this\n    wx.showActionSheet({\n      itemList: ['修改封面图片', '重新上传视频', '删除视频', '删除封面'],\n      itemColor: '#FCC0A4',\n      success (res) {\n        if (res.tapIndex * 1 === 0) {\n          that.editVideo()\n        } else if (res.tapIndex * 1 === 1) {\n          that.upVideo()\n        } else if (res.tapIndex * 1 === 2) {\n          let upVideo = {\n            url: useUrl.updateVideoUrl,\n            data: {\n              session_key: wx.getStorageSync('session_key'),\n              file: ''\n            },\n            success (res) {\n              wx.hideLoading()\n              // console.log(res)\n              // let jsonObj = JSON.parse(res.data).data.res_file\n              that.setData({\n                videoSrc: '',\n                hasvideo: false\n              })\n            }\n          }\n          app.wxrequest(upVideo)\n        } else if (res.tapIndex * 1 === 3) {\n          app.wxrequest({\n            url: useUrl.updateVideoImage,\n            data: {\n              session_key: wx.getStorageSync('session_key'),\n              video_image: ''\n            },\n            success () {\n              wx.hideLoading()\n              that.setData({\n                videoCover: '../../images/login-bg.png'\n              })\n            }\n          })\n        }\n      }\n    })\n  },\n  // 编辑相册封面\n  editVideo () {\n    let that = this\n    let obj = {\n      count: 1,\n      success (res) {\n        wx.showLoading({\n          title: '图片上传中',\n          mask: true\n        })\n        let i = res.tempFilePaths[0]\n        let upImg = {\n          url: useUrl.uploadPhotos,\n          filePath: i,\n          formData: {\n            session_key: wx.getStorageSync('session_key'),\n            file: i\n          },\n          success (res) {\n            wx.hideLoading()\n            let jsonObj = JSON.parse(res.data).data.res_file\n            let coverObj = {\n              url: useUrl.updateVideoImage,\n              data: {\n                session_key: wx.getStorageSync('session_key'),\n                video_image: jsonObj\n              },\n              success (res) {\n                // console.log(res)\n                that.setData({\n                  videoCover: jsonObj\n                })\n                wx.showToast({\n                  title: res.data.message\n                })\n              }\n            }\n            app.wxrequest(coverObj)\n          },\n          fail (res) {\n            // console.log('上传错误', res)\n            wx.showToast({\n              title: '图片上传失败，请重新尝试',\n              mask: true,\n              duration: 1000\n            })\n          }\n        }\n        app.wxUpload(upImg)\n      },\n      fail (err) {\n        console.log(err)\n      }\n    }\n    wx.chooseImage(obj)\n  },\n  videodel () {\n    this.setData({\n      show: true\n    })\n  },\n  // 获取自己的资料\n  getMyInfoid () {\n    // let that = this\n    let getobj = {\n      url: useUrl.getUserInfoBySelf,\n      data: {\n        session_key: wx.getStorageSync('session_key')\n      },\n      success (res) {\n        wx.navigateTo({\n          url: `../userInfo/userInfo?userId=${res.data.data.user_id}&type=self`\n        })\n      }\n    }\n    app.wxrequest(getobj)\n  },\n  // 重新拉起授权\n  getUserInfo () {\n    if (this.data.logins) {\n      wx.navigateTo({\n        url: '../userziliao/userziliao'\n      })\n      return\n    }\n    let that = this\n    wx.openSetting({\n      success (res) {\n        if (res.authSetting['scope.userInfo']) {\n          wx.getUserInfo({\n            success (data) {\n              // console.log(data)\n              wx.setStorageSync('userInfo', data.userInfo)\n              that.setData({\n                userInfo: data.userInfo,\n                logins: true\n              })\n              app.wxlogin(that.getMyInfo)\n            }\n          })\n        }\n      }\n    })\n  },\n  // 播放视屏\n  playVideo () {\n    let s = wx.getSystemInfoSync()\n    let ss = false\n    // console.log(s)\n    if (s.brand === 'iPhone' && parseInt(s.system.split(' ')[1]) <= 10) {\n      // console.log(1)\n      ss = true\n      wx.showModal({\n        title: '视频播放',\n        content: '由于IOS版本较低，视频无法播放',\n        showCancel: false,\n        success (res) {\n          if (res.confirm) {\n            return\n          }\n        }\n      })\n    }\n    // if (ss) {\n    //   setTimeout(() => {\n    //     this.setData({\n    //       autoplay: true,\n    //       show: false,\n    //       playStatus: true\n    //     })\n    //   }, 1500)\n    // } else {\n    //   this.setData({\n    //     autoplay: true,\n    //     show: false,\n    //     playStatus: true\n    //   })\n    // }\n    if (!ss) {\n      this.setData({\n        autoplay: true,\n        show: false,\n        playStatus: true\n      })\n    }\n    // console.log('s', parseInt(s.system))\n    // // if (s.brand && parseInt(s.system < 10.3))\n    // this.setData({\n    //   autoplay: true,\n    //   show: false,\n    //   playStatus: true\n    // })\n  },\n  // 视频播放结束\n  playFinish () {\n    this.setData({\n      autoplay: false,\n      show: true,\n      playStatus: false\n    })\n  },\n  getMessage () {\n    let that = this\n    let obj = {\n      url: useUrl.userHasNewMessage,\n      data: {\n        session_key: wx.getStorageSync('session_key')\n      },\n      success (res) {\n        if (res.data.data.isHas * 1 === 1) {\n          that.setData({\n            hasmessage: true\n          })\n        } else {\n          that.setData({\n            hasmessage: false\n          })\n        }\n      }\n    }\n    app.wxrequest(obj)\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad () {\n    // TODO: onLoad\n    // app.wxlogin()\n    let that = this\n    if (wx.getStorageSync('userInfo')) {\n      wx.login({\n        success () {\n          wx.getUserInfo({\n            success (res) {\n              // console.log(res)\n              res.userInfo['check'] = true\n              that.setData({\n                userInfo: res.userInfo,\n                logins: true\n              })\n            }\n          })\n        }\n      })\n    } else {\n      this.setData({\n        logins: false\n      })\n    }\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    this.getMessage()\n    this.getMyInfo()\n    // let s =\n    // console.log('s',s.system.split(\" \"))\n    // console.log('s', )\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  }\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  // onPullDownRefresh () {\n  //   // TODO: onPullDownRefresh\n  //   // wx.stopPullDownRefresh()\n  //   // if (!this.data.hasvideo) return\n  //   // this.playVideo()\n  // }\n})\n"]}