{"version":3,"sources":["pages/invitedConfirm/invitedConfirm.js"],"names":["app","getApp","useUrl","require","Page","data","datashows","payYx","checkUser","that","obj","url","isPerfectData","session_key","wx","getStorageSync","success","res","is_perfect_data","toString","setData","isShiyue","cancelshow","isHasBaomoney","moneyshow","wxrequest","phoneNumberIn","e","mobile","detail","value","delMask","payByBond","yxObj","timeStamp","nonceStr","package","paySign","errMsg","showToast","title","mask","fail","console","log","setTimeout","reLaunch","wxpay","confirmInvited","addApplyByInvitation","order_id","orderId","message","code","icon","duration","datingSuccess","image","onLoad","params","confirmedByInvitation","id","text","redirectTo","time","order_date","replace","week","order_time","orderInfo","onReady","onShow","getPhone","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"invitedConfirm.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\nconst useUrl = require('../../utils/service')\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    datashows: false,\n    payYx: false\n  },\n  // 用户资料检查\n  checkUser () {\n    let that = this\n    let obj = {\n      url: useUrl.isPerfectData,\n      data: {\n        session_key: wx.getStorageSync('session_key')\n      },\n      success (res) {\n        if (res.data.data.is_perfect_data.toString() === '0') {\n          that.setData({\n            datashows: true\n          })\n        } else if (res.data.data.is_perfect_data.toString() === '1') {\n          // 完整数据 1\n          that.setData({\n            datashows: false\n          })\n        }\n        if (res.data.data.isShiyue.toString() === '1') {\n          // 失约超过次数 1超\n          that.setData({\n            cancelshow: true\n          })\n        }\n        if (res.data.data.isHasBaomoney.toString() === '0') {\n          // 无保证金 0\n          that.setData({\n            moneyshow: true\n          })\n        }\n      }\n    }\n    app.wxrequest(obj)\n  },\n  // 获取用户输入的手机号码\n  phoneNumberIn (e) {\n    this.setData({\n      mobile: e.detail.value\n    })\n  },\n  // 去除遮罩层\n  delMask () {\n    let that = this\n    // 发起意向金的支付100支付\n    let obj = {\n      url: useUrl.payByBond,\n      data: {\n        session_key: wx.getStorageSync('session_key')\n      },\n      success (res) {\n        // console.log(res)\n          // todo 支付\n        let yxObj = {\n          timeStamp: res.data.data.timeStamp,\n          nonceStr: res.data.data.nonceStr,\n          package: res.data.data.package,\n          paySign: res.data.data.paySign,\n          success (res) {\n            // 支付成功\n            if (res.errMsg === 'requestPayment:ok') {\n              wx.showToast({\n                title: '保证金充值成功',\n                mask: true\n              })\n              that.setData({\n                moneyshow: false\n              })\n            }\n          },\n          fail (res) {\n            // 支付失败\n            console.log('支付失败', res)\n            wx.showToast({\n              title: '充值失败，请再次尝试',\n              mask: true\n            })\n            setTimeout(function () {\n              wx.reLaunch({\n                url: '../index2/index2'\n              })\n            }, 1000)\n          }\n        }\n        app.wxpay(yxObj)\n      }\n    }\n    app.wxrequest(obj)\n  },\n  // 意向应邀确认\n  confirmInvited () {\n    if (this.data.moneyshow) {\n      return this.setData({\n        payYx: true\n      })\n    }\n    let that = this\n    let obj = {\n      url: useUrl.addApplyByInvitation,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: that.data.orderId,\n        mobile: that.data.mobile\n      },\n      success (res) {\n        console.log('意向应邀', res)\n        // console.log(res.data.message)\n        if (res.data.message === '申请邀约成功' || res.data.code === 200) {\n          wx.showToast({\n            title: res.data.message,\n            icon: 'success',\n            duration: 1500,\n            mask: true\n          })\n          // setTimeout(function () {\n          //   wx.reLaunch({\n          //     url: '../index2/index2'\n          //   })\n          // }, 1500)\n          that.setData({\n            datingSuccess: true\n          })\n        } else {\n          wx.showToast({\n            title: res.data.message,\n            image: '../../images/jiong.png',\n            duration: 1500,\n            mask: true\n          })\n          // setTimeout(function () {\n          //   wx.reLaunch({\n          //     url: '../index2/index2'\n          //   })\n          // }, 1500)\n        }\n      }\n    }\n    app.wxrequest(obj)\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (params) {\n    // if (wx.getStorageSync('phoneNumber')) {\n    //   this.setData({\n    //     mobile: app.getPhone()\n    //   })\n    // }\n    let that = this\n    // todo 获取套餐信息\n    let obj = {\n      url: useUrl.confirmedByInvitation,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: params.id\n      },\n      success (res) {\n        if (res.data.code === 400) {\n          let text = '哎呀，您来晚了，该邀约已生效'\n          if (res.data.message === '不能应邀自己发起的邀约') {\n            text = '不能应邀自己发起的邀约'\n            wx.showToast({\n              title: text,\n              mask: true\n            })\n            return setTimeout(function () {\n              wx.redirectTo({\n                url: '../userOrder/userOrder'\n              })\n            }, 1500)\n          }\n          wx.showToast({\n            title: text,\n            mask: true\n          })\n          return setTimeout(function () {\n            wx.reLaunch({\n              url: '../index2/index2'\n            })\n          }, 1500)\n        }\n        res.data.data.time = res.data.data.order_date.replace(/-/g, '.') + '(' + res.data.data.week + ')' + res.data.data.order_time\n        that.setData({\n          orderInfo: res.data.data\n        })\n        // console.log(res.data.data)\n      }\n    }\n    app.wxrequest(obj)\n    this.setData({\n      title: params.title,\n      orderId: params.id\n    })\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    this.checkUser()\n    // this.setData({\n    //   mobile: app.getPhone()\n    // })\n    app.getPhone(this)\n    // console.log(app.getPhone())\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}