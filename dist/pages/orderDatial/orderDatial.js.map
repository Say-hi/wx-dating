{"version":3,"sources":["pages/orderDatial/orderDatial.js"],"names":["app","getApp","useUrl","require","Page","data","title","orderArr","type","payType","datingInfo","text","getOrderInfo","id","that","obj","url","orderDetail","session_key","wx","getStorageSync","order_id","success","res","code","showToast","message","mask","setTimeout","navigateBack","delta","s","order_date","order_week","order_time","address","duixiang","user_nicename","money","mobile","is_zhidai","pay_type","setData","info","wxrequest","getUserInfo","ss","isPerfectData","isShiyue","payorder","getUserMoney","showLoading","hideLoading","orderMask","goPay","orderPayobj","payByOrder","console","log","length","moneyPay","closeMoneyMask","gum","payIndex","coin","e","payObj","timeStamp","nonceStr","package","paySign","errMsg","fail","wxpay","onLoad","params","duration","status","pay","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"orderDatial.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\nconst useUrl = require('../../utils/service')\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: '订单详情',\n    orderArr: ['发布中', '已确认', '已消费', '订单关闭', '已取消订单', '订单关闭'],\n    type: ['寻约会对象', '自带约会对象'],\n    payType: ['替TA付清', '发起人付清', '各付各', '应邀者付清'],\n    datingInfo: [\n      {\n        title: '时间',\n        text: '暂无数据'\n      },\n      {\n        title: '地址',\n        text: '暂无数据'\n      },\n      {\n        title: '约会对象',\n        text: '暂无数据'\n      },\n      {\n        title: '费用',\n        text: '暂无数据'\n      },\n      {\n        title: '联系手机',\n        text: '暂无数据'\n      },\n      {\n        title: '约会类型',\n        text: '暂无数据'\n      },\n      {\n        title: '付款类型',\n        text: '暂无数据'\n      }\n    ]\n  },\n  // 获取订单信息\n  getOrderInfo (id) {\n    let that = this\n    let obj = {\n      url: useUrl.orderDetail,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: id\n      },\n      success (res) {\n        // console.log(res)\n        if (res.data.code === 400) {\n          wx.showToast({\n            title: res.data.message,\n            mask: true\n          })\n          setTimeout(function () {\n            wx.navigateBack({\n              delta: 1\n            })\n          }, 1000)\n          return\n        }\n        let s = res.data.data\n        let datingInfo = that.data.datingInfo\n        datingInfo[0].text = s.order_date + '(' + s.order_week + ')' + s.order_time\n        datingInfo[1].text = s.address\n        datingInfo[2].text = s.duixiang.user_nicename || '暂无数据'\n        datingInfo[3].text = s.money\n        datingInfo[4].text = s.mobile || '暂无数据'\n        datingInfo[5].text = that.data.type[s.is_zhidai * 1 - 1]\n        datingInfo[6].text = that.data.payType[s.pay_type * 1]\n        that.setData({\n          info: s,\n          datingInfo: datingInfo\n        })\n      }\n    }\n    app.wxrequest(obj)\n  },\n  getUserInfo () {\n    let that = this\n    let ss = {\n      url: useUrl.isPerfectData,\n      data: {\n        session_key: wx.getStorageSync('session_key')\n      },\n      success (res) {\n        that.setData({\n          money: res.data.data.isShiyue * 1\n        })\n      }\n    }\n    app.wxrequest(ss)\n  },\n  payorder () {\n    this.getUserMoney()\n    wx.showLoading({\n      title: '请求支付中...'\n    })\n    setTimeout(() => {\n      wx.hideLoading()\n      this.setData({\n        orderMask: true\n      })\n    }, 300)\n  },\n  // 支付\n  goPay () {\n    wx.showLoading({title: '等待中'})\n    let that = this\n    let orderPayobj = {\n      url: useUrl.payByOrder,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: that.data.id\n      },\n      success (res) {\n        wx.hideLoading()\n        console.log('pay order', res)\n        // 需要支付的发起付款\n        if (res.data.data.length !== 0) {\n          // todo 微信支付流程\n          that.moneyPay(res.data.data)\n          return\n        } else {\n          if (res.data.code === 400) {\n            wx.showToast({\n              title: res.data.message\n            })\n          }\n          // if (res.data.message === '应邀者付清') {\n          //   return wx.showToast({\n          //     title: '需应邀者付清'\n          //   })\n          // } else if (res.data.message === '该订单已经完成支付') {\n          //   return wx.showToast({\n          //     title: '该订单已完成支付'\n          //   })\n          // }\n          that.setData({\n            orderMask: false\n          })\n          setTimeout(() => {\n            wx.navigateBack({\n              delta: 1\n            })\n          }, 500)\n          // that.getOrderInfo(that.data.id)\n          // that.onLoad(that.data.params)\n        }\n      }\n    }\n    app.wxrequest(orderPayobj)\n  },\n  // 关闭弹窗\n  closeMoneyMask () {\n    this.setData({\n      orderMask: false\n    })\n  },\n  // 获取用户金额情况\n  getUserMoney () {\n    let that = this\n    let gum = {\n      url: useUrl.payIndex,\n      data: {\n        session_key: wx.getStorageSync('session_key')\n      },\n      success (res) {\n        if (res.data.code === 200) {\n          that.setData({\n            coin: res.data.data.coin || 0\n          })\n        } else {\n          wx.showToast({\n            title: res.data.message\n          })\n        }\n      }\n    }\n    app.wxrequest(gum)\n  },\n  moneyPay (e) {\n    // console.log(e)\n    let that = this\n    // 支付参数\n    let payObj = {\n      timeStamp: e.timeStamp,\n      nonceStr: e.nonceStr,\n      package: e.package,\n      paySign: e.paySign,\n      success (res) {\n        // 支付成功响应\n        console.log('支付情况', res)\n        if (res.errMsg === 'requestPayment:ok') {\n          wx.showToast({\n            title: '支付成功'\n          })\n          that.setData({\n            orderMask: false\n          })\n          that.getOrderInfo(that.data.id)\n          // that.onLoad(that.data.params)\n        }\n      },\n      fail (res) {\n        wx.showToast({\n          title: '未完成支付'\n        })\n        console.log('支付失败', res)\n      }\n    }\n    app.wxpay(payObj)\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (params) {\n    this.setData({\n      params: params\n    })\n    // console.log(!params.id)\n    if (params.id === 'null') {\n      // console.log(1)\n      wx.showToast({\n        title: '无法查看尚未确认订单',\n        duration: 1000,\n        mask: true\n      })\n      return setTimeout(function () {\n        wx.navigateBack({\n          delta: 1\n        })\n      })\n    } else {\n      this.setData({\n        id: params.id,\n        status: params.status,\n        pay: params.pay\n      })\n      this.getOrderInfo(params.id)\n      this.getUserInfo()\n    }\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}