{"version":3,"sources":["pages/photo/photo.js"],"names":["app","getApp","useUrl","require","Page","data","title","userPhotos","delphoto","e","index","currentTarget","dataset","photos","splice","setData","getMyInfo","url","that","getMO","session_key","wx","getStorageSync","success","res","wxrequest","getOther","id","obj","otherUserPhotos","user_id","showImg","imgArr","newImgArr","i","push","photo_url","current","urls","previewImage","upPhoto","count","showLoading","mask","tempFilePaths","upImg","uploadPhotos","filePath","formData","file","hideLoading","jsonObj","JSON","parse","res_file","is_ta","length","showToast","image","duration","slice","fail","console","log","wxUpload","err","chooseImage","upMyPhoto","uMobj","updatePhotos","stringify","message","onLoad","params","myPhotos","type","setNavigationBarTitle","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"photo.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\nconst useUrl = require('../../utils/service')\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'photo',\n    userPhotos: []\n  },\n  // 删除图片\n  delphoto (e) {\n    let index = e.currentTarget.dataset.index\n    let photos = this.data.userPhotos\n    photos.splice(index, 1)\n    this.setData({\n      userPhotos: photos\n    })\n  },\n  // 获取相册信息\n  getMyInfo (url) {\n    let that = this\n    let getMO = {\n      url: url,\n      data: {\n        session_key: wx.getStorageSync('session_key')\n      },\n      success (res) {\n        that.setData({\n          userPhotos: res.data.data || []\n        })\n      }\n    }\n    app.wxrequest(getMO)\n  },\n  // 获取他人相册\n  getOther (id) {\n    let that = this\n    let obj = {\n      url: useUrl.otherUserPhotos,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        user_id: id\n      },\n      success (res) {\n        that.setData({\n          userPhotos: res.data.data\n        })\n      }\n    }\n    app.wxrequest(obj)\n  },\n  // 显示图片\n  showImg (e) {\n    let index = e.currentTarget.dataset.index\n    let imgArr = this.data.userPhotos\n    let newImgArr = []\n    for (let i of imgArr) {\n      newImgArr.push(i.photo_url)\n    }\n    let obj = {\n      current: newImgArr[index],\n      urls: newImgArr\n    }\n    wx.previewImage(obj)\n  },\n  // 用户上传图片\n  upPhoto () {\n    let that = this\n    let obj = {\n      count: 1,\n      success (res) {\n        wx.showLoading({\n          title: '图片上传中',\n          mask: true\n        })\n        let userPhotos = that.data.userPhotos\n        for (let i of res.tempFilePaths) {\n          let upImg = {\n            url: useUrl.uploadPhotos,\n            filePath: i,\n            formData: {\n              session_key: wx.getStorageSync('session_key'),\n              file: i\n            },\n            success (res) {\n              wx.hideLoading()\n              let jsonObj = JSON.parse(res.data).data.res_file\n              // console.log(jsonObj)\n              userPhotos.push({\n                photo_url: jsonObj,\n                is_ta: 0\n              })\n              if (userPhotos.length > 9) {\n                wx.showToast({\n                  title: '超过9张啦,已删除多余的照片',\n                  image: '../../images/jiong.png',\n                  duration: 2000,\n                  mask: true\n                })\n              }\n              userPhotos = userPhotos.slice(0, 9)\n              that.setData({\n                userPhotos: userPhotos\n              })\n              // console.log('obj', JSON.parse(res.data))\n            },\n            fail (res) {\n              console.log('上传错误', res)\n              wx.showToast({\n                title: '图片上传失败，请重新尝试',\n                mask: true,\n                duration: 1000\n              })\n            }\n          }\n          app.wxUpload(upImg)\n        }\n      },\n      fail (err) {\n        console.log(err)\n      }\n    }\n    wx.chooseImage(obj)\n  },\n  // 更新我的相册\n  upMyPhoto () {\n    let that = this\n    // let upPhoto = []\n    // for (let i of that.data.userPhotos) {\n    //   upPhoto.push(i.photo_url)\n    // }\n    let uMobj = {\n      url: useUrl.updatePhotos,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        photos: JSON.stringify(that.data.userPhotos)\n      },\n      success (res) {\n        if (res.data.message === '更新成功') {\n          wx.showToast({\n            title: '更新成功',\n            mask: true\n          })\n        } else {\n          wx.showToast({\n            title: '服务开小差了，请稍后再尝试',\n            mask: true\n          })\n        }\n      }\n    }\n    app.wxrequest(uMobj)\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (params) {\n    if (params.id) {\n      this.setData({\n        id: params.id\n      })\n    } else {\n      this.getMyInfo(useUrl.myPhotos)\n    }\n    if (params.type === 'other' || params.type === 's') {\n      this.setData({\n        type: 'other'\n      })\n      wx.setNavigationBarTitle({\n        title: 'Ta的相册'\n      })\n      this.getOther(params.id)\n    }\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}