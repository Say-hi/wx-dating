{"version":3,"sources":["pages/follow/follow.js"],"names":["app","getApp","useUrl","require","Page","data","title","page","people","content","nohao","closeMask","setData","mask","stillmask","searchValue","e","that","obj","url","getUserSubscribe","session_key","wx","getStorageSync","user_name","detail","value","success","res","length","showToast","image","duration","wxrequest","inputtext","follows","currentTarget","dataset","follow","id","fbj","remindSubscribe","subscribe_user_id","code","goNewfollow","navigateTo","getFollowUser","search","text","s","concat","getstranger","gsbj","userHasNewStranger","isHas","message","stopPullDownRefresh","onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh","onReachBottom"],"mappings":"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","file":"follow.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\nconst useUrl = require('../../utils/service')\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'follow',\n    page: 1,\n    people: [],\n    content: '',\n    nohao: false\n  },\n  closeMask () {\n    this.setData({\n      mask: false\n    })\n  },\n  stillmask () {\n    this.setData({\n      mask: true\n    })\n  },\n  // 用户确认搜索\n  searchValue (e) {\n    // this.getFollowUser(1, e.detail.value, '没有搜索到相关用户')\n    let that = this\n    let obj = {\n      url: useUrl.getUserSubscribe,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        page: 1,\n        user_name: e.detail.value\n      },\n      success (res) {\n        // console.log(res)\n        if (res.data.data.length === 0 || !res.data.data) {\n          return wx.showToast({\n            title: '亲，没有搜索到相关用户',\n            image: '../../images/jiong.png',\n            duration: 1000,\n            mask: true\n          })\n        }\n        // let s = that.data.people.reverse().concat(res.data.data).reverse()\n        that.data.people = []\n        that.setData({\n          people: res.data.data\n        })\n      }\n    }\n    app.wxrequest(obj)\n  },\n  // 文本输入\n  inputtext (e) {\n    this.setData({\n      content: e.detail.value\n    })\n  },\n  // 弹窗\n  follows (e) {\n    if (e.currentTarget.dataset.follow * 1 === 1) {\n      return wx.showToast({\n        title: '您和Ta已互相关注啦',\n        mask: true,\n        duration: 1000\n      })\n    }\n    this.setData({\n      mask: true,\n      id: e.currentTarget.dataset.id\n    })\n  },\n  // 关注\n  follow () {\n    let that = this\n    if (that.data.content.length >= 20) {\n      return wx.showToast({\n        title: '超出字数限制'\n      })\n    }\n    // console.log(that.data.id)\n    let fbj = {\n      url: useUrl.remindSubscribe,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        subscribe_user_id: that.data.id,\n        content: that.data.content || 'hi, 快来关注我吧'\n      },\n      success (res) {\n        that.setData({\n          mask: false\n        })\n        if (res.data.code === 400) {\n          return wx.showToast({\n            title: '亲，一天只能提醒Ta一次哦~'\n          })\n        }\n        wx.showToast({\n          title: '提醒成功'\n        })\n      }\n    }\n    app.wxrequest(fbj)\n  },\n  // 跳转到消息页面\n  goNewfollow () {\n    // if (this.data.message) {\n    wx.navigateTo({\n      url: '../newfollow/newfollow'\n    })\n    // }\n  },\n  // 获取用户关注的用户的列表\n  getFollowUser (page, search, text) {\n    let that = this\n    let obj = {\n      url: useUrl.getUserSubscribe,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        page: page,\n        user_name: search || ''\n      },\n      success (res) {\n        // console.log(res)\n        if (res.data.code === 200) {\n          if (!res.data.data && page * 1 === 1) {\n            return that.setData({\n              nohao: true\n            })\n          }\n          let s = that.data.people.concat(res.data.data)\n          that.setData({\n            people: s,\n            nohao: false\n          })\n        } else {\n          wx.showToast({\n            title: '请在个人中心登陆后使用小程序'\n          })\n        }\n      }\n    }\n    app.wxrequest(obj)\n  },\n  // 获取陌生人提醒\n  getstranger () {\n    let that = this\n    let gsbj = {\n      url: useUrl.userHasNewStranger,\n      data: {\n        session_key: wx.getStorageSync('session_key')\n      },\n      success (res) {\n        if (res.data.data.isHas * 1 === 1) {\n          that.setData({\n            message: true\n          })\n        } else {\n          that.setData({\n            message: false\n          })\n        }\n        wx.stopPullDownRefresh()\n      }\n    }\n    app.wxrequest(gsbj)\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad () {\n    // TODO: onLoad\n    // this.setData({\n    //   page: 1,\n    //   people: []\n    // })\n    // this.getFollowUser(1)\n    // this.getstranger()\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n    this.setData({\n      page: 1,\n      people: []\n    })\n    this.getFollowUser(1)\n    this.getstranger()\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n    this.setData({\n      people: [],\n      page: 1\n    })\n    this.getFollowUser(1)\n    this.getstranger()\n  },\n  onReachBottom () {\n    this.getFollowUser(++this.data.page)\n  }\n})\n"]}