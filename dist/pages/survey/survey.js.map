{"version":3,"sources":["pages/survey/survey.js"],"names":["app","getApp","useUrl","require","Page","data","title","userInfo","curChoose","chooseArr","name","value","text","write","hide","goUser","e","wx","navigateTo","url","currentTarget","dataset","id","delMask","setData","show","goback","navigateBack","delta","noChange","showToast","image","index","getQuestionDetail","that","queObj","questionnairesDetail","session_key","getStorageSync","success","res","s","questionnaires_info","question_one","question_two","question_three","question_four","type","user_info","job","split","wxrequest","getduixiang","orderid","ssobj","editeQuestionnaires","order_id","InputValue","detail","sendMessage","sendObj","postQuestionnaires","user_id","console","log","onLoad","params","from","orderId","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":";;AAAA;AACA,IAAMA,MAAMC,QAAZ;AACA,IAAMC,SAASC,QAAQ,qBAAR,CAAf;AACA;AACAC,KAAK;AACH;;;AAGAC,QAAM;AACJC,WAAO,QADH;AAEJC,cAAU;AACR;AACA;AACA;AAHQ,KAFN;AAOJC,eAAW,CAPP;AAQJC,eAAW,CACT;AACEC,YAAM,QADR;AAEEC,aAAO,IAFT;AAGEC,YAAM;AAHR,KADS,EAMT;AACEF,YAAM,MADR;AAEEC,aAAO,IAFT;AAGEC,YAAM;AAHR,KANS,EAWT;AACEF,YAAM,MADR;AAEEC,aAAO,IAFT;AAGEC,YAAM;AAHR,KAXS,CARP;AAyBJC,WAAO,KAzBH;AA0BJC,UAAM;AA1BF,GAJH;AAgCHC,QAhCG,kBAgCKC,CAhCL,EAgCQ;AACTC,OAAGC,UAAH,CAAc;AACZC,4CAAoCH,EAAEI,aAAF,CAAgBC,OAAhB,CAAwBC;AADhD,KAAd;AAGD,GApCE;AAqCHC,SArCG,qBAqCQ;AACT,SAAKC,OAAL,CAAa;AACXC,YAAM;AADK,KAAb;AAGD,GAzCE;AA0CHC,QA1CG,oBA0CO;AACRT,OAAGU,YAAH,CAAgB;AACdC,aAAO;AADO,KAAhB;AAGD,GA9CE;;AA+CH;AACAnB,WAhDG,qBAgDQO,CAhDR,EAgDW;AACZ,QAAI,KAAKX,IAAL,CAAUwB,QAAd,EAAwB;AACtB,aAAOZ,GAAGa,SAAH,CAAa;AAClBxB,eAAO,MADW;AAElByB,eAAO;AAFW,OAAb,CAAP;AAID;AACD,SAAKP,OAAL,CAAa;AACXhB,iBAAWQ,EAAEI,aAAF,CAAgBC,OAAhB,CAAwBW;AADxB,KAAb;AAGD,GA1DE;;AA2DH;AACAC,mBA5DG,6BA4DgBX,EA5DhB,EA4DoB;AACrB,QAAIY,OAAO,IAAX;AACA,QAAIC,SAAS;AACXhB,WAAKjB,OAAOkC,oBADD;AAEX/B,YAAM;AACJgC,qBAAapB,GAAGqB,cAAH,CAAkB,aAAlB,CADT;AAEJhB,YAAIA;AAFA,OAFK;AAMXiB,aANW,mBAMFC,GANE,EAMG;AACZ;AACA,YAAIC,IAAID,IAAInC,IAAJ,CAASA,IAAT,CAAcqC,mBAAtB;AACAR,aAAKV,OAAL,CAAa;AACXmB,wBAAcF,EAAEE,YADL;AAEXC,wBAAcH,EAAEG,YAFL;AAGXC,0BAAgBJ,EAAEI,cAHP;AAIXC,yBAAeL,EAAEK,aAJN;AAKXtC,qBAAWiC,EAAEM;AALF,SAAb;AAOA,YAAI,CAACP,IAAInC,IAAJ,CAASA,IAAT,CAAc2C,SAAnB,EAA8B;AAC9BR,YAAInC,IAAJ,CAASA,IAAT,CAAc2C,SAAd,CAAwBC,GAAxB,GAA8BT,IAAInC,IAAJ,CAASA,IAAT,CAAc2C,SAAd,CAAwBC,GAAxB,CAA4BC,KAA5B,CAAkC,GAAlC,EAAuC,CAAvC,CAA9B;AACAhB,aAAKV,OAAL,CAAa;AACXjB,oBAAUiC,IAAInC,IAAJ,CAASA,IAAT,CAAc2C;AADb,SAAb;AAGD;AArBU,KAAb;AAuBAhD,QAAImD,SAAJ,CAAchB,MAAd;AACD,GAtFE;;AAuFH;AACAiB,aAxFG,uBAwFUC,OAxFV,EAwFmB;AACpB,QAAInB,OAAO,IAAX;AACA,QAAIoB,QAAQ;AACVnC,WAAKjB,OAAOqD,mBADF;AAEVlD,YAAM;AACJgC,qBAAapB,GAAGqB,cAAH,CAAkB,aAAlB,CADT;AAEJkB,kBAAUH;AAFN,OAFI;AAMVd,aANU,mBAMDC,GANC,EAMI;AACZ;AACAA,YAAInC,IAAJ,CAASA,IAAT,CAAc4C,GAAd,GAAoBT,IAAInC,IAAJ,CAASA,IAAT,CAAc4C,GAAd,CAAkBC,KAAlB,CAAwB,GAAxB,EAA6B,CAA7B,CAApB;AACAhB,aAAKV,OAAL,CAAa;AACXjB,oBAAUiC,IAAInC,IAAJ,CAASA;AADR,SAAb;AAGD;AAZS,KAAZ;AAcAL,QAAImD,SAAJ,CAAcG,KAAd;AACD,GAzGE;;AA0GH;AACAG,YA3GG,sBA2GSzC,CA3GT,EA2GY;AACb,QAAIL,QAAQK,EAAE0C,MAAF,CAAS/C,KAArB;AACA,QAAIoC,OAAO/B,EAAEI,aAAF,CAAgBC,OAAhB,CAAwB0B,IAAnC;AACA,QAAIA,SAAS,YAAb,EAA2B;AACzB,WAAKvB,OAAL,CAAa;AACXmB,sBAAchC;AADH,OAAb;AAGD,KAJD,MAIO,IAAIoC,SAAS,QAAb,EAAuB;AAC5B,WAAKvB,OAAL,CAAa;AACXoB,sBAAcjC;AADH,OAAb;AAGD,KAJM,MAIA,IAAIoC,SAAS,UAAb,EAAyB;AAC9B,WAAKvB,OAAL,CAAa;AACXqB,wBAAgBlC;AADL,OAAb;AAGD,KAJM,MAIA,IAAIoC,SAAS,OAAb,EAAsB;AAC3B,WAAKvB,OAAL,CAAa;AACXsB,uBAAenC;AADJ,OAAb;AAGD;AACF,GA/HE;;AAgIH;AACAgD,aAjIG,yBAiIY;AACb,QAAIzB,OAAO,IAAX;AACA,QAAI0B,UAAU;AACZzC,WAAKjB,OAAO2D,kBADA;AAEZxD,YAAM;AACJgC,qBAAapB,GAAGqB,cAAH,CAAkB,aAAlB,CADT;AAEJwB,iBAAS5B,KAAK7B,IAAL,CAAUE,QAAV,CAAmBuD,OAFxB;AAGJN,kBAAUtB,KAAK7B,IAAL,CAAUE,QAAV,CAAmBiD,QAHzB;AAIJb,sBAAcT,KAAK7B,IAAL,CAAUsC,YAAV,IAA0B,KAJpC;AAKJC,sBAAcV,KAAK7B,IAAL,CAAUuC,YAAV,IAA0B,KALpC;AAMJC,wBAAgBX,KAAK7B,IAAL,CAAUwC,cAAV,IAA4B,KANxC;AAOJC,uBAAeZ,KAAK7B,IAAL,CAAUyC,aAAV,IAA2B,KAPtC;AAQJC,cAAMb,KAAK7B,IAAL,CAAUG;AARZ,OAFM;AAYZ+B,aAZY,mBAYHC,GAZG,EAYE;AACZ;AACA,YAAIA,IAAInC,IAAJ,CAASA,IAAT,KAAkB,MAAtB,EAA8B;AAC5BY,aAAGU,YAAH,CAAgB;AACdC,mBAAO;AADO,WAAhB;AAGD,SAJD,MAIO;AACLmC,kBAAQC,GAAR,CAAY,MAAZ,EAAoBxB,GAApB;AACAvB,aAAGa,SAAH,CAAa;AACXxB,mBAAO;AADI,WAAb;AAGD;AACF;AAxBW,KAAd;AA0BAN,QAAImD,SAAJ,CAAcS,OAAd;AACD,GA9JE;;AA+JH;;;AAGAK,QAlKG,kBAkKKC,MAlKL,EAkKa;AACd;AACA;AACA,QAAIA,OAAOC,IAAP,KAAgB,MAApB,EAA4B;AAC1B,WAAK3C,OAAL,CAAa;AACXhB,mBAAW,CADA;AAEXqB,kBAAU;AAFC,OAAb;AAID;AACD,QAAIqC,OAAO5C,EAAP,GAAY,CAAZ,KAAkB,CAAtB,EAAyB;AACvB,WAAKE,OAAL,CAAa;AACXX,eAAO;AADI,OAAb;AAGD,KAJD,MAIO;AACL;AACA,WAAKoB,iBAAL,CAAuBiC,OAAO5C,EAA9B;AACA,WAAKE,OAAL,CAAa;AACXV,cAAM;AADK,OAAb;AAGD;AACD,SAAKsC,WAAL,CAAiBc,OAAOE,OAAxB;AACD,GAvLE;;;AAyLH;;;AAGAC,SA5LG,qBA4LQ;AACT;AACD,GA9LE;;;AAgMH;;;AAGAC,QAnMG,oBAmMO;AACR;AACD,GArME;;;AAuMH;;;AAGAC,QA1MG,oBA0MO;AACR;AACD,GA5ME;;;AA8MH;;;AAGAC,UAjNG,sBAiNS;AACV;AACD,GAnNE;;;AAqNH;;;AAGAC,mBAxNG,+BAwNkB;AACnB;AACD;AA1NE,CAAL","file":"survey.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\nconst useUrl = require('../../utils/service')\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'survey',\n    userInfo: {\n      // avatarUrl: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n      // nickName: '兔子',\n      // gender: 1\n    },\n    curChoose: 2,\n    chooseArr: [\n      {\n        name: 'noshow',\n        value: '匿名',\n        text: '等待对方收到至少2份匿名问卷后才能看到'\n      },\n      {\n        name: 'show',\n        value: '交换',\n        text: '需要对方填写提交后才能看到'\n      },\n      {\n        name: 'free',\n        value: '开放',\n        text: '无条件开放给对方看'\n      }\n    ],\n    write: false,\n    hide: true\n  },\n  goUser (e) {\n    wx.navigateTo({\n      url: `../userInfo/userInfo?userId=${e.currentTarget.dataset.id}`\n    })\n  },\n  delMask () {\n    this.setData({\n      show: false\n    })\n  },\n  goback () {\n    wx.navigateBack({\n      delta: 1\n    })\n  },\n  // 选择交换方式\n  chooseArr (e) {\n    if (this.data.noChange) {\n      return wx.showToast({\n        title: '不可修改',\n        image: '../../images/jiong.png'\n      })\n    }\n    this.setData({\n      curChoose: e.currentTarget.dataset.index\n    })\n  },\n  // 获取问卷详情\n  getQuestionDetail (id) {\n    let that = this\n    let queObj = {\n      url: useUrl.questionnairesDetail,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        id: id\n      },\n      success (res) {\n        // console.log(res)\n        let s = res.data.data.questionnaires_info\n        that.setData({\n          question_one: s.question_one,\n          question_two: s.question_two,\n          question_three: s.question_three,\n          question_four: s.question_four,\n          curChoose: s.type\n        })\n        if (!res.data.data.user_info) return\n        res.data.data.user_info.job = res.data.data.user_info.job.split('-')[1]\n        that.setData({\n          userInfo: res.data.data.user_info\n        })\n      }\n    }\n    app.wxrequest(queObj)\n  },\n  // 获取约会对象信息\n  getduixiang (orderid) {\n    let that = this\n    let ssobj = {\n      url: useUrl.editeQuestionnaires,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: orderid\n      },\n      success (res) {\n        // console.log(res)\n        res.data.data.job = res.data.data.job.split('-')[1]\n        that.setData({\n          userInfo: res.data.data\n        })\n      }\n    }\n    app.wxrequest(ssobj)\n  },\n  // 写入内容\n  InputValue (e) {\n    let value = e.detail.value\n    let type = e.currentTarget.dataset.type\n    if (type === 'impression') {\n      this.setData({\n        question_one: value\n      })\n    } else if (type === 'moment') {\n      this.setData({\n        question_two: value\n      })\n    } else if (type === 'possible') {\n      this.setData({\n        question_three: value\n      })\n    } else if (type === 'doing') {\n      this.setData({\n        question_four: value\n      })\n    }\n  },\n  // 提交信息\n  sendMessage () {\n    let that = this\n    let sendObj = {\n      url: useUrl.postQuestionnaires,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        user_id: that.data.userInfo.user_id,\n        order_id: that.data.userInfo.order_id,\n        question_one: that.data.question_one || '未填写',\n        question_two: that.data.question_two || '未填写',\n        question_three: that.data.question_three || '未填写',\n        question_four: that.data.question_four || '未填写',\n        type: that.data.curChoose\n      },\n      success (res) {\n        // console.log(res)\n        if (res.data.data === '提交成功') {\n          wx.navigateBack({\n            delta: 1\n          })\n        } else {\n          console.log('提交错误', res)\n          wx.showToast({\n            title: '啊哦，服务器开小差了，请稍后再试'\n          })\n        }\n      }\n    }\n    app.wxrequest(sendObj)\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (params) {\n    // let that = this\n    // 填写问卷\n    if (params.from === 'show') {\n      this.setData({\n        curChoose: 1,\n        noChange: true\n      })\n    }\n    if (params.id * 1 === 0) {\n      this.setData({\n        write: true\n      })\n    } else {\n      // 查看自己填写的问卷\n      this.getQuestionDetail(params.id)\n      this.setData({\n        hide: false\n      })\n    }\n    this.getduixiang(params.orderId)\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}