{"version":3,"sources":["pages/cancelOrder/cancelOrder.js"],"names":["app","getApp","useUrl","require","Page","data","title","value","shiYue","flag","items","name","checked","checkboxChange","setData","confirmBtn","that","status","cancelOrder","replyOrder","inputValue","e","detail","delMask","show","wx","switchTab","url","getUserInfo","userObj","isPerfectData","session_key","getStorageSync","success","res","shiyue_num","wxrequest","getOrderInfo","id","orderObj","cancelOrderDetail","order_id","order","is_zudong","zd","getOrderInfoTwo","obj","orderDetail","infoTwo","length","showToast","mask","replyObj","huifuOrderCancel","content","code","setTimeout","navigateBack","delta","message","cancelObj","cancel_liyou","check","console","log","is_zhidai","onLoad","params","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"cancelOrder.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\nconst useUrl = require('../../utils/service')\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'cancelOrder',\n    value: '',\n    shiYue: false,\n    flag: false,\n    // order: {\n    //   number: 1232416,\n    //   type: 0, // 0 自己发起的 1 别人发起的\n    //   img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n    //   title: 'Kiss Bottle 全新手工制甜品餐',\n    //   time: '2017.05.20 18:30',\n    //   address: '珠江新城',\n    //   money: 158,\n    //   pImg: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n    //   pName: '凸角',\n    //   pGender: 1,\n    //   pReason: '萨克的覅双方都刷卡地方萨克的浪费和萨阿斯顿飞哈斯的空间费',\n    //   pId: 12312321,\n    //   zd: false\n    // },\n    items: [\n      {\n        name: '1',\n        value: '对方爽约，且不愿主动取消赴约',\n        checked: false\n      }\n    ]\n  },\n  // 选择框\n  checkboxChange () {\n    let items = this.data.items\n    items[0].checked = !items[0].checked\n    this.setData({\n      items: items\n    })\n  },\n  confirmBtn () {\n    if (this.data.flag) return\n    this.data.flag = true\n    let that = this\n    if (this.data.status === 1) {\n      that.cancelOrder()\n    } else if (this.data.status === 4) {\n      that.replyOrder()\n    }\n  },\n  inputValue (e) {\n    this.setData({\n      value: e.detail.value\n    })\n  },\n  // 关闭弹窗\n  delMask () {\n    this.setData({\n      show: false\n    })\n    wx.switchTab({\n      url: '../index2/index2'\n    })\n  },\n  // 获取用户资料\n  getUserInfo () {\n    let that = this\n    let userObj = {\n      url: useUrl.isPerfectData,\n      data: {\n        session_key: wx.getStorageSync('session_key')\n      },\n      success (res) {\n        if (res.data.data.shiyue_num >= 4) {\n          that.setData({\n            shiYue: true\n          })\n        }\n      }\n    }\n    app.wxrequest(userObj)\n  },\n  // 获取订单信息\n  getOrderInfo (id) {\n    let that = this\n    let orderObj = {\n      url: useUrl.cancelOrderDetail,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: id\n      },\n      success (res) {\n        that.setData({\n          order: res.data.data,\n          order_id: id\n        })\n        if (res.data.data.is_zudong * 1 === 1) {\n          that.setData({\n            zd: true\n          })\n        }\n      }\n    }\n    app.wxrequest(orderObj)\n  },\n\n  // 获取订单信息\n  getOrderInfoTwo (id) {\n    let that = this\n    let obj = {\n      url: useUrl.orderDetail,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: id\n      },\n      success (res) {\n        that.setData({\n          infoTwo: res.data.data || ''\n        })\n      }\n    }\n    app.wxrequest(obj)\n  },\n  // 回复取消订单\n  replyOrder () {\n    let that = this\n    if (this.data.value.length === 0) {\n      this.data.flag = false\n      return wx.showToast({\n        title: '您还没有填写回复理由呢',\n        mask: true\n      })\n    }\n    let replyObj = {\n      url: useUrl.huifuOrderCancel,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: that.data.order_id,\n        content: that.data.value\n      },\n      success (res) {\n        that.data.flag = false\n        if (res.data.code === 200) {\n          wx.showToast({\n            title: '回复成功',\n            mask: true\n          })\n          setTimeout(function () {\n            wx.navigateBack({\n              delta: 1\n            })\n          }, 1500)\n        } else {\n          wx.showToast({\n            title: res.data.message\n          })\n        }\n      }\n    }\n    app.wxrequest(replyObj)\n  },\n  // 取消订单\n  cancelOrder () {\n    if (this.data.value.length === 0) {\n      this.data.flag = false\n      return wx.showToast({\n        title: '您还没有填写理由呢~~',\n        mask: true\n      })\n    }\n    let that = this\n    let cancelObj = {\n      url: useUrl.cancelOrder,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: that.data.order_id,\n        cancel_liyou: that.data.value,\n        check: that.data.items[0].checked ? '1' : '0'\n      },\n      success (res) {\n        console.log(res)\n        that.data.flag = false\n        if (res.data.code === 200) {\n          if (that.data.order.is_zhidai * 1 === 2) {\n            wx.showToast({\n              title: '订单已取消，款项已原路退回',\n              mask: true\n            })\n          } else {\n            wx.showToast({\n              title: '订单已取消，等待审核退款',\n              mask: true\n            })\n          }\n          setTimeout(function () {\n            wx.navigateBack({\n              delta: 1\n            })\n          }, 1500)\n        } else {\n          wx.showToast({\n            title: res.data.message\n          })\n        }\n      }\n    }\n    app.wxrequest(cancelObj)\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (params) {\n    // TODO: onLoad\n    if (params.status * 1 === 1) {\n      this.setData({\n        zd: true\n      })\n    } else if (params.status * 1 === 4) {\n      this.setData({\n        zd: false\n      })\n    }\n    this.setData({\n      status: params.status * 1\n    })\n    this.getOrderInfo(params.id)\n    this.getOrderInfoTwo(params.id)\n    this.getUserInfo()\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}