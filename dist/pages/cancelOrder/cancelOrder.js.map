{"version":3,"sources":["pages/cancelOrder/cancelOrder.js"],"names":["app","getApp","useUrl","require","Page","data","title","value","shiYue","flag","flagTwo","items","name","checked","checkboxChange","setData","confirmBtn","that","status","cancelOrder","replyOrder","inputValue","e","detail","delMask","show","wx","switchTab","url","getUserInfo","userObj","isPerfectData","session_key","getStorageSync","success","res","shiyue_num","wxrequest","getOrderInfo","id","orderObj","cancelOrderDetail","order_id","order","is_zudong","zd","getOrderInfoTwo","obj","orderDetail","infoTwo","replyObj","huifuOrderCancel","content","code","showToast","mask","setTimeout","navigateBack","delta","message","length","cancelObj","cancel_liyou","check","is_zhidai","onLoad","params","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"cancelOrder.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\nconst useUrl = require('../../utils/service')\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'cancelOrder',\n    value: '',\n    shiYue: false,\n    flag: false,\n    flagTwo: false,\n    // order: {\n    //   number: 1232416,\n    //   type: 0, // 0 自己发起的 1 别人发起的\n    //   img: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n    //   title: 'Kiss Bottle 全新手工制甜品餐',\n    //   time: '2017.05.20 18:30',\n    //   address: '珠江新城',\n    //   money: 158,\n    //   pImg: 'http://img02.tooopen.com/images/20150928/tooopen_sy_143912755726.jpg',\n    //   pName: '凸角',\n    //   pGender: 1,\n    //   pReason: '萨克的覅双方都刷卡地方萨克的浪费和萨阿斯顿飞哈斯的空间费',\n    //   pId: 12312321,\n    //   zd: false\n    // },\n    items: [\n      {\n        name: '1',\n        value: '对方爽约，且不愿主动取消赴约',\n        checked: false\n      }\n    ]\n  },\n  // 选择框\n  checkboxChange () {\n    let items = this.data.items\n    items[0].checked = !items[0].checked\n    this.setData({\n      items: items\n    })\n  },\n  confirmBtn () {\n    if (this.data.flag) return\n    this.data.flag = true\n    let that = this\n    if (this.data.status === 1) {\n      that.cancelOrder()\n    } else if (this.data.status === 4) {\n      that.replyOrder()\n    }\n  },\n  inputValue (e) {\n    this.setData({\n      value: e.detail.value\n    })\n  },\n  // 关闭弹窗\n  delMask () {\n    this.setData({\n      show: false\n    })\n    wx.switchTab({\n      url: '../index2/index2'\n    })\n  },\n  // 获取用户资料\n  getUserInfo () {\n    let that = this\n    let userObj = {\n      url: useUrl.isPerfectData,\n      data: {\n        session_key: wx.getStorageSync('session_key')\n      },\n      success (res) {\n        if (res.data.data.shiyue_num >= 4) {\n          that.setData({\n            shiYue: true\n          })\n        }\n      }\n    }\n    app.wxrequest(userObj)\n  },\n  // 获取订单信息\n  getOrderInfo (id) {\n    let that = this\n    let orderObj = {\n      url: useUrl.cancelOrderDetail,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: id\n      },\n      success (res) {\n        that.setData({\n          order: res.data.data,\n          order_id: id\n        })\n        if (res.data.data.is_zudong * 1 === 1) {\n          that.setData({\n            zd: true\n          })\n        }\n      }\n    }\n    app.wxrequest(orderObj)\n  },\n\n  // 获取订单信息\n  getOrderInfoTwo (id) {\n    let that = this\n    let obj = {\n      url: useUrl.orderDetail,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: id\n      },\n      success (res) {\n        that.setData({\n          infoTwo: res.data.data || ''\n        })\n      }\n    }\n    app.wxrequest(obj)\n  },\n  // 回复取消订单\n  replyOrder () {\n    let that = this\n    // if (this.data.value.length === 0) {\n    //   this.data.flag = false\n    //   return wx.showToast({\n    //     title: '您还没有填写回复理由呢',\n    //     mask: true\n    //   })\n    // }\n    let replyObj = {\n      url: useUrl.huifuOrderCancel,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: that.data.order_id,\n        content: that.data.value || '未填写理由'\n      },\n      success (res) {\n        if (res.data.code === 200) {\n          wx.showToast({\n            title: '回复成功',\n            mask: true\n          })\n          setTimeout(function () {\n            wx.navigateBack({\n              delta: 1\n            })\n          }, 1500)\n        } else {\n          that.data.flag = false\n          wx.showToast({\n            title: res.data.message\n          })\n        }\n      }\n    }\n    app.wxrequest(replyObj)\n  },\n  // 取消订单\n  cancelOrder () {\n    // if (this.data.flagTwo) return\n    if (this.data.value.length === 0) {\n      this.data.flag = false\n      return wx.showToast({\n        title: '您还没有填写理由呢~~',\n        mask: true\n      })\n    }\n    // this.data.flag = true\n    let that = this\n    let cancelObj = {\n      url: useUrl.cancelOrder,\n      data: {\n        session_key: wx.getStorageSync('session_key'),\n        order_id: that.data.order_id,\n        cancel_liyou: that.data.value || '未填写理由',\n        check: that.data.items[0].checked ? '1' : '0'\n      },\n      success (res) {\n        // console.log(res)\n        if (res.data.code === 200) {\n          if (that.data.order.is_zhidai * 1 === 2) {\n            wx.showToast({\n              title: '订单已取消，款项将原路退回',\n              mask: true\n            })\n          } else {\n            wx.showToast({\n              title: '订单已取消，等待审核退款',\n              mask: true\n            })\n          }\n          setTimeout(function () {\n            wx.navigateBack({\n              delta: 1\n            })\n          }, 1500)\n        } else {\n          that.data.flag = false\n          wx.showToast({\n            title: res.data.message\n          })\n        }\n      }\n    }\n    app.wxrequest(cancelObj)\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (params) {\n    // TODO: onLoad\n    if (params.status * 1 === 1) {\n      this.setData({\n        zd: true\n      })\n    } else if (params.status * 1 === 4) {\n      this.setData({\n        zd: false\n      })\n    }\n    this.setData({\n      status: params.status * 1\n    })\n    this.getOrderInfo(params.id)\n    this.getOrderInfoTwo(params.id)\n    this.getUserInfo()\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}